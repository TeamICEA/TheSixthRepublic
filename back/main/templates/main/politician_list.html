{% extends 'main/base.html' %}
{% load static %}

{% block title %}정치인별 기본 데이터 & 정치인의 성향 리포트{% endblock %}

{% block content %}
<div class="politician-list-container">
    <!-- 페이지 제목 -->
    <div class="page-header">
        <h1 class="page-title">정치인별 기본 데이터 & 정치인의 성향 리포트</h1>
    </div>
    
    <!-- 필터링 및 검색 영역 -->
    <div class="filter-search-section">
        <!-- 정당별 필터 버튼 -->
        <div class="filter-buttons-container">
            <!-- 전체 버튼 -->
            <a href="{% url 'politician_list' %}" 
               class="filter-button {% if not party_query %}active{% endif %}">
                전체
            </a>
            
            <!-- 정당별 버튼 -->
            {% for party in parties_for_buttons %}
            <a href="?party={{ party.id }}{% if name_query %}&name={{ name_query }}{% endif %}" 
               class="filter-button {% if party_query == party.id|stringformat:'s' %}active{% endif %}">
                {{ party.name }}
            </a>
            {% endfor %}
        </div>
        
        <!-- 이름 검색 -->
        <div class="search-container">
            <form method="get" class="search-form">
                {% if party_query %}
                <input type="hidden" name="party" value="{{ party_query }}">
                {% endif %}
                
                <div class="search-input-group">
                    <input type="text" 
                           name="name" 
                           class="search-input" 
                           placeholder="이름을 입력하세요"
                           value="{{ name_query }}">
                    <button type="submit" class="search-button">찾기</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 정치인 목록 테이블 -->
    <div class="table-section">
        <table class="politicians-table">
            <thead>
                <tr>
                    <th class="col-photo">사진</th>
                    <th class="col-name">이름</th>
                    <th class="col-hanja">한자</th>
                    <th class="col-birth">출생</th>
                    <th class="col-party">정당</th>
                    <th class="col-region">지역</th>
                    <th class="col-action">찾기</th>
                </tr>
            </thead>
            <tbody>
                {% for politician in page_obj %}
                <tr class="politician-row" onclick="goToDetail('{{ politician.str_id }}')">
                    <td class="col-photo">
                        {% if politician.pic_link %}
                        <img src="{{ politician.pic_link }}" 
                             alt="{{ politician.name }}" 
                             class="politician-photo"
                             onerror="this.src='{% static 'main/images/default-profile.png' %}'">
                        {% else %}
                        <div class="photo-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                        {% endif %}
                    </td>
                    <td class="col-name">{{ politician.name }}</td>
                    <td class="col-hanja">{{ politician.hanja_name|default:"(한자)" }}</td>
                    <td class="col-birth">
                        {% if politician.birthdate %}
                            {{ politician.birthdate.year }}
                        {% else %}
                            1964
                        {% endif %}
                    </td>
                    <td class="col-party">{{ politician.party.name }}</td>
                    <td class="col-region">{{ politician.address|truncatechars:10|default:"인천" }}</td>
                    <td class="col-action">
                        <button class="detail-button" onclick="event.stopPropagation(); goToDetail('{{ politician.str_id }}')">
                            <i class="fas fa-search"></i>
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="empty-row">
                        <div class="empty-message">
                            <p>검색 결과가 없습니다.</p>
                            {% if name_query or party_query %}
                            <a href="{% url 'politician_list' %}" class="reset-link">전체 목록 보기</a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- 페이지네이션 -->
    {% if page_obj.has_other_pages %}
    <div class="pagination-section">
        <div class="pagination-container">
            <!-- 이전 버튼 -->
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if name_query %}&name={{ name_query }}{% endif %}{% if party_query %}&party={{ party_query }}{% endif %}" 
               class="pagination-btn">이전</a>
            {% endif %}
            
            <!-- 페이지 번호들 -->
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                <span class="pagination-btn active">{{ num }}</span>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <a href="?page={{ num }}{% if name_query %}&name={{ name_query }}{% endif %}{% if party_query %}&party={{ party_query }}{% endif %}" 
                   class="pagination-btn">{{ num }}</a>
                {% endif %}
            {% endfor %}
            
            <!-- 페이지 정보 -->
            <span class="page-info">{{ page_obj.start_index }}-{{ page_obj.end_index }}</span>
            
            <!-- 다음 버튼 -->
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if name_query %}&name={{ name_query }}{% endif %}{% if party_query %}&party={{ party_query }}{% endif %}" 
               class="pagination-btn">다음</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
function goToDetail(strId) {
    window.location.href = `/${strId}/`;
}

// 검색 폼 검증
document.querySelector('.search-form').addEventListener('submit', function(e) {
    const nameInput = this.querySelector('input[name="name"]');
    if (nameInput.value.trim() === '') {
        e.preventDefault();
        nameInput.focus();
        alert('검색할 이름을 입력해주세요.');
    }
});
</script>
{% endblock %}